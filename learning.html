<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>äº’åŠ¨å•è¯å­¦ä¹ </title>
  <link rel="stylesheet" href="learning.css">
</head>
<body>
  <!-- é¡µé¢ç»“æ„ä¿æŒä¸å˜ -->
  <a href="home.html" class="back-home-btn">å›åˆ°ä¸»é¡µ</a>
  
  <div class="assistant">
    <img src="as.png" alt="åŠ©æ‰‹" class="assistant-image">
    <div class="dialogue-box">
      <p id="guideText">è¯·ç‚¹å‡»å›¾ç‰‡ä¸Šçš„ç‰©å“ï¼Œæ¥å­¦ä¹ è¿™å¼ å›¾ç‰‡ä¸Šçš„å•è¯å§ï¼ (0/3)</p>
    </div>
  </div>

 
  <div id="nextButtonContainer" class="next-button-container"></div>
  
  <div class="image-container">
    <!-- å›¾ç‰‡å’Œçƒ­åŒºå°†ç”±JavaScriptåŠ¨æ€ç”Ÿæˆ -->
  </div>

  <div id="wordCard" class="word-card">
    <h2 id="wordTitle"></h2>
    <p><strong>ä¸­æ–‡ï¼š</strong><span id="zhText"></span></p>
    <p><strong>éŸ³æ ‡ï¼š</strong><span id="spellingText"></span></p>
    <p><strong>ä¾‹å¥ï¼š</strong><span id="exampleText"></span></p>
    <div class="button-group">
      <button onclick="speak()">ğŸ”Š å‘éŸ³</button>
      <button onclick="closeCard()">âœ– å…³é—­</button>
    </div>
  </div>

  <script>
    let currentGroupIndex = 0;
    let learnedWords = new Set();
    let wordsData = {};

    // æ•°æ®åŠ è½½ï¼ˆå¢å¼ºé”™è¯¯å¤„ç†ï¼‰
    fetch('learning.json')
      .then(response => {
        if (!response.ok) throw new Error('HTTPé”™è¯¯');
        return response.json();
      })
      .then(data => {
        wordsData = data;
        loadGroup(currentGroupIndex);
      })
      .catch(error => {
        console.error('åŠ è½½å¤±è´¥:', error);
        alert('å­¦ä¹ èµ„æ–™åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
      });

    // æ˜¾ç¤ºå•è¯å¡ç‰‡ï¼ˆä¿®å¤å­—æ®µåï¼‰
    function showWord(word) {
      const currentGroup = wordsData.groups?.[currentGroupIndex];
      if (!currentGroup) return;

      const wordInfo = currentGroup.areas.find(w => w.word === word);
      if (!wordInfo) {
        alert('æœªæ‰¾åˆ°å•è¯ä¿¡æ¯');
        return;
      }

      if (!learnedWords.has(word)) {
        learnedWords.add(word);
        updateProgress();
      }

      document.getElementById('wordTitle').textContent = word;
      document.getElementById('zhText').textContent = wordInfo.zh;
      document.getElementById('spellingText').textContent = wordInfo.spelling;
      document.getElementById('exampleText').textContent = wordInfo.example;
      document.getElementById('wordCard').style.display = 'block';
    }

    // åŠ è½½åˆ†ç»„ï¼ˆä¿®å¤åæ ‡æ ¼å¼ï¼‰
    function loadGroup(groupIndex) {
      if (!wordsData.groups || groupIndex >= wordsData.groups.length) {
        console.error('æ— æ•ˆçš„ç»„ç´¢å¼•');
        return;
      }

      closeCard();
      const group = wordsData.groups[groupIndex];
      const imageContainer = document.querySelector('.image-container');
      const mapName = `image-map-${groupIndex}`;

      const areasHTML = group.areas.map(word => `
        <area shape="${word.shape}" 
              coords="${word.coords.join(',')}" 
              alt="${word.word}" 
              data-word="${word.word}"
              onclick="showWord('${word.word.replace(/'/g, "\\'")}')"
              onmouseover="showTooltip(event, '${word.zh}')"
              onmouseout="hideTooltip()">
      `).join('');

      imageContainer.innerHTML = `
        <img src="${group.image}" usemap="#${mapName}" class="learning-image">
        <map name="${mapName}">${areasHTML}</map>
      `;

      learnedWords.clear();
      updateProgress();
    }

    // æ›´æ–°è¿›åº¦ï¼ˆä¿®å¤å­—æ®µåï¼‰
    function updateProgress() {
      const currentGroup = wordsData.groups?.[currentGroupIndex];
      if (!currentGroup) return;

      const total = currentGroup.areas.length;
    const guideText = document.getElementById('guideText');
    const nextButtonContainer = document.getElementById('nextButtonContainer');
    
    // å§‹ç»ˆæ˜¾ç¤ºå®Œæ•´è¿›åº¦ï¼ˆåˆ é™¤å¯¹progresså…ƒç´ çš„å¼•ç”¨ï¼‰
    guideText.textContent = 
        learnedWords.size === total 
        ? 'æ­å–œå­¦å®Œæ‰€æœ‰å•è¯ï¼' 
        : `è¯·ç‚¹å‡»å›¾ç‰‡ä¸Šçš„ç‰©å“ï¼Œæ¥å­¦ä¹ è¿™å¼ å›¾ç‰‡ä¸Šçš„å•è¯å§ï¼ (${learnedWords.size}/${total})`;
      
      if (learnedWords.size === total) {
        guideText.textContent = 'æ­å–œå­¦å®Œæ‰€æœ‰å•è¯ï¼';
        nextButtonContainer.innerHTML = currentGroupIndex < wordsData.groups.length - 1 ?
          '<button class="next-button" onclick="nextGroup()">ä¸‹ä¸€é¡µ â†’</button>' :
          '<button class="next-button" onclick="location.href=\'sound.html\'">å®Œæˆå­¦ä¹ ï¼è¿›å…¥å¤ä¹ </button>';
      } else {
        /*guideText.textContent = `è¿˜æœ‰å•è¯æ²¡æœ‰å­¦å®Œå–”ï¼Œè¯·ç»§ç»­å­¦ä¹  (${learnedWords.size}/${total})`;*/
        nextButtonContainer.innerHTML = '';
      }
    }

    // å‘éŸ³åŠŸèƒ½ï¼ˆé€‚é…æ–°æ•°æ®ç»“æ„ï¼‰
    function speak() {
      const word = document.getElementById('wordTitle').textContent;
      const currentGroup = wordsData.groups?.[currentGroupIndex];
      if (!currentGroup) return;

      const targetWord = currentGroup.areas.find(w => w.word === word);
      if (!targetWord?.audio) {
        alert('è¯¥å•è¯æš‚æ— å‘éŸ³èµ„æº');
        return;
      }

      try {
        new Audio(targetWord.audio).play();
      } catch (error) {
        console.error('æ’­æ”¾å¤±è´¥:', error);
        alert('å‘éŸ³å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
      }
    }

    // å…¶ä»–è¾…åŠ©å‡½æ•°ä¿æŒä¸å˜
    function nextGroup() {
      currentGroupIndex++;
      loadGroup(currentGroupIndex);
    }

    function closeCard() {
      document.getElementById('wordCard').style.display = 'none';
    }

    window.addEventListener('click', (e) => {
      if (e.target === document.getElementById('wordCard')) {
        closeCard();
      }
    });

    
  </script>
</body>
</html>